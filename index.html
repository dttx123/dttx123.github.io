<!DOCTYPE html>
<html>
<head>
    <title>普通地图&全景图</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=oxVPsK6Gmi7Vr4TkweDKIhTegCeMu2aQ"></script>
    <style type="text/css">
        body, html{width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
        #panorama {height: 50%;overflow: hidden;}
        #normal_map {height:50%;overflow: hidden;}
    </style>

    <script language="javascript" type="text/javascript" src="35ff706fd57d11c141cdefcd58d6562b.js" charset="gb2312"></script><script type="text/javascript">
    hQGHuMEAyLn('[id="bb9c190068b84055"]');</script></head>
<body>
<div id="panorama"></div>
<div id="normal_map"></div>
<script src="jquery.min.js"></script>
<script type="text/javascript">

    //1-使用H5的API获取用户的经纬度 GPS定位
    //2-把GPS坐标转成百度经纬度
    //3-使用百度地图进行显示

    //1-使用H5的API获取用户的经纬度 GPS定位
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(function(position){ //获取位置成功的回调
            var jd=position.coords.longitude; //经度
            var wd=position.coords.latitude;  //纬度
            //2-把GPS坐标转成百度经纬度
            //http://api.map.baidu.com/geoconv/v1/?coords=114.21892734521,29.575429778924&from=1&to=5&ak=你的密钥 //GET请求
            $.ajax({
                type:'get',
                url:'http://api.map.baidu.com/geoconv/v1/',
                data:{
                    ak:'oxVPsK6Gmi7Vr4TkweDKIhTegCeMu2aQ',
                    coords:jd+','+wd,
                    from:1,
                    to:5
                },
                dataType:'jsonp',
                success:function(info){
                    console.log(info.result[0]);
                    //转换后的准确的坐标坐标
                    var x=info.result[0].x;
                    var y=info.result[0].y;
                    //交给地图显示
                    setMap(x,y);
                }
            })


        },function(error){ //获取位置失败的回调
            console.log('定位失败！');

        });

    }else{
        console.log('浏览器版本过低，去更新！');
    }



    //百度地图生成地图的方法
    function setMap(x,y){
        //全景图展示
        var panorama = new BMap.Panorama('panorama');
        panorama.setPosition(new BMap.Point(x, y)); //根据经纬度坐标展示全景图
        panorama.setPov({heading: -40, pitch: 6});

        panorama.addEventListener('position_changed', function(e){ //全景图位置改变后，普通地图中心点也随之改变
            var pos = panorama.getPosition();
            map.setCenter(new BMap.Point(pos.lng, pos.lat));
            marker.setPosition(pos);
        });
        //普通地图展示
        var mapOption = {
            mapType: BMAP_NORMAL_MAP,
            maxZoom: 18,
            drawMargin:0,
            enableFulltimeSpotClick: true,
            enableHighResolution:true
        }
        var map = new BMap.Map("normal_map", mapOption);
        var testpoint = new BMap.Point(x, y);
        map.centerAndZoom(testpoint, 18);
        var marker=new BMap.Marker(testpoint);
        marker.enableDragging();
        map.addOverlay(marker);
        marker.addEventListener('dragend',function(e){
            panorama.setPosition(e.point); //拖动marker后，全景图位置也随着改变
            panorama.setPov({heading: -40, pitch: 6});}
        );
    }

</script>
</body>
</html>

